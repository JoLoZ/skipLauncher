<link href="main.css" rel="stylesheet" />
<div class="background"></div>
<div class="wrapper">
  <div class="flex-center">
    <center>
      <h1>skipLauncher</h1>
      <button id="launch-btn" style="min-width: 10rem" onclick="btnaction()">
        Login with Microsoft
      </button>
    </center>
  </div>

  <pre class="bottom-text" id="status"></pre>
</div>

<script src="topbar.js"></script>

<script>
  var auth = null;

  function btnaction() {
    if (auth == null) {
      login();
    } else {
      launch();
    }
  }

  function login() {
    ipcRenderer.send("login_new", {
      visible: "select_account"
    });
  }

  ipcRenderer.on("login_update", (event, arg) => {
    $("#status").text(arg.data + "...");
    $("#launch-btn")
      .addClass("loading")
      .prop("disabled", true)
      .text("Loading...");
  });

  ipcRenderer.on("login_result", (event, arg) => {
    auth = arg;
    $("#launch-btn")
      .removeClass("loading")
      .prop("disabled", false)
      .text("Play!");
    $("#status").text("");
  });

  function launch() {
    ipcRenderer.send("launch", {
      auth: auth,
      version: "1.8.9",
    });
    $("#launch-btn")
      .addClass("loading")
      .prop("disabled", true)
      .text("Launching...");
  }

  ipcRenderer.on("launch_msg", (event, arg) => {
    $("#status").text(arg.replaceAll("[MCLC]: ", ""));
    console.log(arg);
  });
</script>
